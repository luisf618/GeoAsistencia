<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GeoAsistencia • Panel</title>
  <style>
    :root{
      --bg1:#0b1020; --bg2:#111a3a; --card:rgba(255,255,255,.08);
      --card2:rgba(255,255,255,.12); --b:rgba(255,255,255,.14);
      --text:rgba(255,255,255,.92); --muted:rgba(255,255,255,.72);
      --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --accent:#8b5cf6; --accent2:#06b6d4;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background: radial-gradient(1100px 700px at 20% 10%, #7c3aed33 0%, transparent 60%),
                  radial-gradient(900px 600px at 90% 20%, #06b6d433 0%, transparent 55%),
                  linear-gradient(180deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }
    .top{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: linear-gradient(90deg, rgba(17,26,58,.75), rgba(11,16,32,.55));
      border-bottom: 1px solid var(--b);
    }
    .wrap{max-width:1200px; margin:0 auto; padding:16px}
    .row{display:flex; gap:12px; align-items:center; justify-content:space-between}
    .brand{display:flex; gap:12px; align-items:center}
    .logo{
      width:44px; height:44px; border-radius:14px;
      background: conic-gradient(from 180deg, var(--accent), var(--accent2), #f97316, var(--accent));
      box-shadow: 0 12px 30px rgba(0,0,0,.35);
    }
    h1{font-size:16px; margin:0}
    .pill{padding:6px 10px; border:1px solid var(--b); border-radius:999px; color:var(--muted); font-size:12px}
    .grid{display:grid; grid-template-columns: 320px 1fr; gap:16px; padding:16px}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      border: 1px solid var(--b);
      border-radius: 18px;
      padding: 14px;
      box-shadow: 0 18px 40px rgba(0,0,0,.25);
    }
    .title{display:flex; justify-content:space-between; align-items:center; gap:10px}
    .title h2{font-size:14px; margin:0}
    .sub{color:var(--muted); font-size:12px; margin-top:6px; line-height:1.35}
    .btn{
      border:1px solid var(--b); background: rgba(255,255,255,.08);
      color:var(--text); padding:10px 12px; border-radius:12px; cursor:pointer;
      transition:.15s transform, .15s filter; font-weight:600;
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.08)}
    .btn.primary{background: linear-gradient(90deg, var(--accent), var(--accent2)); border:none}
    .btn.danger{background: rgba(239,68,68,.18); border:1px solid rgba(239,68,68,.35)}
    .btn.ok{background: rgba(34,197,94,.18); border:1px solid rgba(34,197,94,.35)}
    .btn.small{padding:8px 10px; border-radius:10px; font-size:12px}
    input, select, textarea{
      width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--b);
      background: rgba(0,0,0,.20); color:var(--text); outline:none;
    }
    textarea{min-height: 90px; resize: vertical}
    label{font-size:12px; color:var(--muted)}
    .form{display:grid; gap:10px; margin-top:12px}
    .two{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width: 520px){ .two{grid-template-columns:1fr} }
    .hr{height:1px; background: var(--b); margin:12px 0}
    .nav{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
    .chip{
      padding:8px 10px; border-radius:999px; border:1px solid var(--b);
      background: rgba(255,255,255,.06); cursor:pointer; font-size:12px; font-weight:700;
    }
    .chip.active{background: linear-gradient(90deg, rgba(139,92,246,.35), rgba(6,182,212,.25));}
    table{width:100%; border-collapse: collapse; overflow:hidden; border-radius:16px; border:1px solid var(--b)}
    th,td{padding:10px 10px; font-size:12px; border-bottom:1px solid rgba(255,255,255,.08)}
    th{color:rgba(255,255,255,.85); text-align:left; background: rgba(255,255,255,.06)}
    tr:hover td{background: rgba(255,255,255,.03)}
    .muted{color:var(--muted)}
    .badge{display:inline-flex; gap:6px; align-items:center; padding:6px 10px; border-radius:999px; font-size:12px; border:1px solid var(--b); background: rgba(255,255,255,.05)}
    .dot{width:8px; height:8px; border-radius:99px; background: var(--accent2)}
    .toast{position:fixed; right:14px; bottom:14px; z-index:50; display:grid; gap:8px; max-width: 420px}
    .toast .t{padding:10px 12px; border:1px solid var(--b); border-radius:14px; background: rgba(0,0,0,.55); backdrop-filter: blur(10px)}
    .modal{
      position:fixed; inset:0; background: rgba(0,0,0,.55);
      display:none; align-items:center; justify-content:center; padding:16px; z-index:60;
    }
    .modal.open{display:flex}
    .modal .box{max-width: 560px; width:100%;}
    .count{font-variant-numeric: tabular-nums; font-weight:800}
  </style>
</head>
<body>
  <div class="top">
    <div class="wrap row">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>GeoAsistencia • Panel</h1>
          <div class="sub">Privacidad por diseño: por defecto solo códigos. PII solo con justificación + reautenticación (60s).</div>
        </div>
      </div>
      <div id="who" class="pill">No autenticado</div>
    </div>
  </div>

  <div class="grid wrap">
    <div class="card" id="loginCard">
      <div class="title">
        <h2>Ingreso (ADMIN / SUPERADMIN)</h2>
        <span class="badge"><span class="dot"></span><span>LOPDP</span></span>
      </div>
      <div class="sub">Usa credenciales del seed o tus usuarios. Este panel consume la API del backend.</div>
      <div class="form">
        <div>
          <label>Email</label>
          <input id="email" placeholder="admin@geoasistencia.com" />
        </div>
        <div>
          <label>Contraseña</label>
          <input id="pass" type="password" placeholder="••••••••" />
        </div>
        <button class="btn primary" onclick="login()">Entrar</button>
        <div class="sub">Tip: si ejecutaste seed.py: <b>admin@geoasistencia.com</b> / <b>Admin12345</b></div>
      </div>
    </div>

    <div class="card" id="appCard" style="display:none">
      <div class="title">
        <h2 id="sectionTitle">Usuarios</h2>
        <div class="nav">
          <div class="chip active" id="tabUsers" onclick="setTab('users')">Usuarios</div>
          <div class="chip" id="tabSedes" onclick="setTab('sedes')">Sedes</div>
          <div class="chip" id="tabAudit" onclick="setTab('audit')">Auditoría</div>
          <button class="btn small" onclick="logout()">Salir</button>
        </div>
      </div>
      <div class="sub" id="sectionSub">Códigos por defecto. PII solo por empleado y por 60s.</div>

      <div class="hr"></div>

      <!-- USERS -->
      <div id="usersView">
        <div class="title">
          <h2>Lista de usuarios</h2>
          <button class="btn ok small" onclick="openUserForm()">+ Crear usuario</button>
        </div>
        <div class="sub">ADMIN crea solo EMPLEADO (su sede). SUPERADMIN crea roles y elige sede.</div>
        <div style="margin-top:12px; overflow:auto">
          <table>
            <thead>
              <tr>
                <th>Código</th>
                <th>Rol</th>
                <th>Sede</th>
                <th>Email (máscara)</th>
                <th>PII</th>
              </tr>
            </thead>
            <tbody id="usersTbody"></tbody>
          </table>
        </div>
      </div>

      <!-- SEDES -->
      <div id="sedesView" style="display:none">
        <div class="title">
          <h2>Sedes</h2>
          <button class="btn ok small" onclick="openSedeForm()">+ Crear sede</button>
        </div>
        <div class="sub">Solo SUPERADMIN puede crear/editar sedes.</div>
        <div style="margin-top:12px; overflow:auto">
          <table>
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Lat</th>
                <th>Lng</th>
                <th>Radio (m)</th>
                <th>Dirección</th>
              </tr>
            </thead>
            <tbody id="sedesTbody"></tbody>
          </table>
        </div>
      </div>

      <!-- AUDIT -->
      <div id="auditView" style="display:none">
        <div class="title">
          <h2>Auditoría</h2>
          <button class="btn small" onclick="loadAudit()">Actualizar</button>
        </div>
        <div class="sub">Cada revelación queda registrada con motivo (justificación).</div>
        <div style="margin-top:12px; overflow:auto">
          <table>
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Acción</th>
                <th>Entidad</th>
                <th>Detalle</th>
              </tr>
            </thead>
            <tbody id="auditTbody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: Reveal PII -->
  <div class="modal" id="revealModal">
    <div class="card box">
      <div class="title">
        <h2>Revelar datos personales (60s)</h2>
        <button class="btn small" onclick="closeReveal()">Cerrar</button>
      </div>
      <div class="sub" id="revealTarget">Empleado: —</div>
      <div class="form">
        <div>
          <label>Justificación (mín. 15 caracteres)</label>
          <textarea id="motivo" placeholder="Ej: Validar identidad para corrección de registro de asistencia..." ></textarea>
        </div>
        <div>
          <label>Vuelve a ingresar tu contraseña</label>
          <input id="reauth" type="password" placeholder="••••••••" />
        </div>
        <button class="btn primary" onclick="doReveal()">Solicitar y revelar</button>
        <div class="hr"></div>
        <div id="piiBox" class="card" style="display:none">
          <div class="title"><h2>Datos revelados</h2><div class="pill">Se ocultará en <span class="count" id="count">60</span>s</div></div>
          <div class="sub" id="piiContent" style="margin-top:8px"></div>
          <button class="btn danger small" style="margin-top:10px" onclick="forceHide()">Ocultar ahora</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: Create User -->
  <div class="modal" id="userModal">
    <div class="card box">
      <div class="title">
        <h2>Crear usuario</h2>
        <button class="btn small" onclick="closeUserForm()">Cerrar</button>
      </div>
      <div class="sub">⚠️ Estos datos existen para cuentas. El listado normal sigue mostrando solo códigos.</div>
      <div class="form">
        <div class="two">
          <div>
            <label>Código (DOC-001)</label>
            <input id="u_codigo" placeholder="DOC-010" />
          </div>
          <div>
            <label>Rol</label>
            <select id="u_rol">
              <option>EMPLEADO</option>
              <option>ADMIN</option>
              <option>SUPERADMIN</option>
            </select>
          </div>
        </div>
        <div>
          <label>Nombre real</label>
          <input id="u_nombre" placeholder="Nombre Apellido" />
        </div>
        <div class="two">
          <div>
            <label>Email</label>
            <input id="u_email" placeholder="usuario@empresa.com" />
          </div>
          <div>
            <label>Teléfono</label>
            <input id="u_tel" placeholder="0999999999" />
          </div>
        </div>
        <div>
          <label>Contraseña</label>
          <input id="u_pass" type="password" placeholder="mínimo 6" />
        </div>
        <div>
          <label>Sede (SUPERADMIN)</label>
          <select id="u_sede"></select>
        </div>
        <button class="btn primary" onclick="createUser()">Crear</button>
      </div>
    </div>
  </div>

  <!-- MODAL: Create Sede -->
  <div class="modal" id="sedeModal">
    <div class="card box">
      <div class="title">
        <h2>Crear sede</h2>
        <button class="btn small" onclick="closeSedeForm()">Cerrar</button>
      </div>
      <div class="sub">Solo SUPERADMIN puede crear sedes.</div>
      <div class="form">
        <div>
          <label>Nombre</label>
          <input id="s_nombre" placeholder="Sede Norte" />
        </div>
        <div class="two">
          <div>
            <label>Latitud</label>
            <input id="s_lat" placeholder="-3.99" />
          </div>
          <div>
            <label>Longitud</label>
            <input id="s_lng" placeholder="-79.20" />
          </div>
        </div>
        <div class="two">
          <div>
            <label>Radio (metros)</label>
            <input id="s_radio" type="number" placeholder="120" />
          </div>
          <div>
            <label>Dirección</label>
            <input id="s_dir" placeholder="Loja" />
          </div>
        </div>
        <button class="btn primary" onclick="createSede()">Crear sede</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const API = location.origin;
    let token = localStorage.getItem('ga_token') || '';
    let me = null;
    let currentTab = 'users';
    let revealTargetId = null;
    let revealTargetCodigo = null;
    let revealTimer = null;
    let revealLeft = 0;

    function toast(msg, kind='info'){
      const el = document.createElement('div');
      el.className = 't';
      el.textContent = msg;
      if(kind==='bad') el.style.borderColor = 'rgba(239,68,68,.45)';
      if(kind==='ok') el.style.borderColor = 'rgba(34,197,94,.45)';
      document.getElementById('toast').appendChild(el);
      setTimeout(()=>{el.remove()}, 3200);
    }

    async function api(path, opts={}){
      const headers = Object.assign({'Content-Type':'application/json'}, opts.headers||{});
      if(token && !headers.Authorization) headers.Authorization = 'Bearer ' + token;
      const r = await fetch(API + path, Object.assign({}, opts, {headers}));
      let data = null;
      try{ data = await r.json(); }catch{ data = null; }
      if(!r.ok){
        const detail = data && (data.detail || JSON.stringify(data)) || ('HTTP ' + r.status);
        throw new Error(detail);
      }
      return data;
    }

    async function login(){
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('pass').value;
      try{
        const res = await api('/admin/login', {method:'POST', body: JSON.stringify({email, password})});
        token = res.token;
        localStorage.setItem('ga_token', token);
        await bootstrap();
        toast('Bienvenido: ' + res.rol, 'ok');
      }catch(e){ toast('Login: ' + e.message, 'bad'); }
    }

    function logout(){
      token = '';
      localStorage.removeItem('ga_token');
      me = null;
      document.getElementById('loginCard').style.display = '';
      document.getElementById('appCard').style.display = 'none';
      document.getElementById('who').textContent = 'No autenticado';
      toast('Sesión cerrada');
    }

    function setTab(tab){
      currentTab = tab;
      document.getElementById('tabUsers').classList.toggle('active', tab==='users');
      document.getElementById('tabSedes').classList.toggle('active', tab==='sedes');
      document.getElementById('tabAudit').classList.toggle('active', tab==='audit');
      document.getElementById('usersView').style.display = tab==='users' ? '' : 'none';
      document.getElementById('sedesView').style.display = tab==='sedes' ? '' : 'none';
      document.getElementById('auditView').style.display = tab==='audit' ? '' : 'none';
      document.getElementById('sectionTitle').textContent = tab==='users' ? 'Usuarios' : (tab==='sedes' ? 'Sedes' : 'Auditoría');
      document.getElementById('sectionSub').textContent = tab==='users' ? 'Códigos por defecto. PII solo por empleado y por 60s.' : (tab==='sedes' ? 'Geocercas por sede (solo SUPERADMIN).' : 'Registro de acciones críticas y revelaciones de PII.');
      if(tab==='users') loadUsers();
      if(tab==='sedes') loadSedes();
      if(tab==='audit') loadAudit();
    }

    async function bootstrap(){
      try{
        me = await api('/admin/me');
        document.getElementById('loginCard').style.display = 'none';
        document.getElementById('appCard').style.display = '';
        document.getElementById('who').textContent = me.rol + ' • ' + me.codigo;

        // SUPERADMIN: habilita tab sedes y selector de sede en crear usuario
        const isSuper = me.rol === 'SUPERADMIN';
        document.getElementById('tabSedes').style.display = isSuper ? '' : 'none';
        await loadSedesForSelect();
        setTab('users');
      }catch(e){
        logout();
      }
    }

    async function loadUsers(){
      try{
        const users = await api('/admin/usuarios');
        const tbody = document.getElementById('usersTbody');
        tbody.innerHTML = '';
        users.forEach(u=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><b>${escapeHtml(u.codigo)}</b></td>
            <td>${escapeHtml(u.rol)}</td>
            <td class="muted">${escapeHtml(u.sede_id || '—')}</td>
            <td class="muted">${escapeHtml(u.email_mask || '—')}</td>
            <td><button class="btn small" onclick="openReveal('${u.usuario_id}','${escapeJs(u.codigo)}')">Solicitar acceso (PII)</button></td>
          `;
          tbody.appendChild(tr);
        })
      }catch(e){ toast('Usuarios: ' + e.message, 'bad'); }
    }

    async function loadSedes(){
      try{
        const sedes = await api('/admin/sedes');
        const tbody = document.getElementById('sedesTbody');
        tbody.innerHTML='';
        sedes.forEach(s=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td><b>${escapeHtml(s.nombre)}</b></td>
            <td class="muted">${escapeHtml(String(s.latitud))}</td>
            <td class="muted">${escapeHtml(String(s.longitud))}</td>
            <td>${escapeHtml(String(s.radio_metros))}</td>
            <td class="muted">${escapeHtml(s.direccion || '—')}</td>
          `;
          tbody.appendChild(tr);
        })
      }catch(e){ toast('Sedes: ' + e.message, 'bad'); }
    }

    async function loadAudit(){
      try{
        const logs = await api('/admin/audit?limit=120');
        const tbody = document.getElementById('auditTbody');
        tbody.innerHTML='';
        logs.forEach(l=>{
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="muted">${escapeHtml((l.timestamp||'').replace('T',' ').replace('Z',''))}</td>
            <td><b>${escapeHtml(l.accion)}</b></td>
            <td class="muted">${escapeHtml(l.entidad)} • ${escapeHtml(l.entidad_id||'—')}</td>
            <td class="muted">${escapeHtml(JSON.stringify(l.detalle||{}))}</td>
          `;
          tbody.appendChild(tr);
        })
      }catch(e){ toast('Auditoría: ' + e.message, 'bad'); }
    }

    // Reveal flow
    function openReveal(usuarioId, codigo){
      revealTargetId = usuarioId;
      revealTargetCodigo = codigo;
      document.getElementById('revealTarget').textContent = 'Empleado: ' + codigo;
      document.getElementById('motivo').value='';
      document.getElementById('reauth').value='';
      document.getElementById('piiBox').style.display='none';
      document.getElementById('revealModal').classList.add('open');
      stopTimer();
    }
    function closeReveal(){
      document.getElementById('revealModal').classList.remove('open');
      stopTimer();
    }
    function stopTimer(){
      if(revealTimer){ clearInterval(revealTimer); revealTimer=null; }
    }
    function forceHide(){
      stopTimer();
      document.getElementById('piiBox').style.display='none';
      toast('Datos ocultados', 'ok');
    }

    async function doReveal(){
      const motivo = document.getElementById('motivo').value.trim();
      const password = document.getElementById('reauth').value;
      if(motivo.length < 15){ toast('Justificación muy corta (mín 15).', 'bad'); return; }
      if(!password){ toast('Ingresa tu contraseña.', 'bad'); return; }
      try{
        const res = await api('/admin/privacy/reveal', {method:'POST', body: JSON.stringify({target_usuario_id: revealTargetId, motivo, password})});
        const revealToken = res.reveal_token;
        const pii = await fetchPII(revealToken, revealTargetId);

        document.getElementById('piiContent').innerHTML = `
          <div><span class="muted">Código:</span> <b>${escapeHtml(pii.codigo)}</b></div>
          <div><span class="muted">Nombre real:</span> <b>${escapeHtml(pii.nombre_real)}</b></div>
          <div><span class="muted">Email:</span> <b>${escapeHtml(pii.email)}</b></div>
          <div><span class="muted">Teléfono:</span> <b>${escapeHtml(pii.telefono || '—')}</b></div>
        `;
        document.getElementById('piiBox').style.display='';

        // countdown 60s
        revealLeft = res.expires_in || 60;
        document.getElementById('count').textContent = String(revealLeft);
        stopTimer();
        revealTimer = setInterval(()=>{
          revealLeft -= 1;
          document.getElementById('count').textContent = String(Math.max(0,revealLeft));
          if(revealLeft <= 0){ forceHide(); }
        }, 1000);
        toast('Datos revelados por 60s', 'ok');
        // refresca auditoría en background (si está en esa pestaña)
        if(currentTab==='audit') loadAudit();
      }catch(e){ toast('Revelar: ' + e.message, 'bad'); }
    }

    async function fetchPII(revealToken, usuarioId){
      const r = await fetch(API + '/admin/privacy/usuarios/' + usuarioId + '/pii', {
        headers: {Authorization: 'Bearer ' + revealToken}
      });
      const data = await r.json().catch(()=>null);
      if(!r.ok) throw new Error((data && data.detail) || ('HTTP ' + r.status));
      return data;
    }

    // Create user
    function openUserForm(){
      document.getElementById('userModal').classList.add('open');
      // ADMIN: solo EMPLEADO
      const isSuper = me && me.rol === 'SUPERADMIN';
      const selRol = document.getElementById('u_rol');
      selRol.value = 'EMPLEADO';
      selRol.disabled = !isSuper;
      document.getElementById('u_sede').disabled = !isSuper;
    }
    function closeUserForm(){ document.getElementById('userModal').classList.remove('open'); }

    async function loadSedesForSelect(){
      const sel = document.getElementById('u_sede');
      sel.innerHTML = '';
      try{
        // SUPERADMIN obtiene sedes, ADMIN solo su sede (cargamos placeholder)
        if(!token) return;
        if(me && me.rol === 'SUPERADMIN'){
          const sedes = await api('/admin/sedes');
          sedes.forEach(s=>{
            const o = document.createElement('option');
            o.value = s.sede_id;
            o.textContent = s.nombre + ' • ' + s.sede_id;
            sel.appendChild(o);
          })
        } else {
          const o = document.createElement('option');
          o.value = me ? me.sede_id : '';
          o.textContent = 'Tu sede';
          sel.appendChild(o);
        }
      }catch(e){ /* ignore */ }
    }

    async function createUser(){
      const documento = document.getElementById('u_codigo').value.trim();
      const rol = document.getElementById('u_rol').value;
      const nombre_real = document.getElementById('u_nombre').value.trim();
      const email = document.getElementById('u_email').value.trim();
      const telefono = document.getElementById('u_tel').value.trim();
      const password = document.getElementById('u_pass').value;
      const sede_id = document.getElementById('u_sede').value;

      try{
        await api('/admin/usuarios', {method:'POST', body: JSON.stringify({documento, rol, nombre_real, email, telefono, password, sede_id})});
        toast('Usuario creado', 'ok');
        closeUserForm();
        loadUsers();
      }catch(e){ toast('Crear usuario: ' + e.message, 'bad'); }
    }

    // Create sede
    function openSedeForm(){ document.getElementById('sedeModal').classList.add('open'); }
    function closeSedeForm(){ document.getElementById('sedeModal').classList.remove('open'); }
    async function createSede(){
      const nombre = document.getElementById('s_nombre').value.trim();
      const latitud = document.getElementById('s_lat').value.trim();
      const longitud = document.getElementById('s_lng').value.trim();
      const radio_metros = parseInt(document.getElementById('s_radio').value || '0', 10);
      const direccion = document.getElementById('s_dir').value.trim();
      try{
        await api('/admin/sedes', {method:'POST', body: JSON.stringify({nombre, latitud, longitud, radio_metros, direccion})});
        toast('Sede creada', 'ok');
        closeSedeForm();
        loadSedes();
        loadSedesForSelect();
      }catch(e){ toast('Crear sede: ' + e.message, 'bad'); }
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, (c)=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"}[c]));
    }
    function escapeJs(s){
      return String(s).replace(/'/g, "\\'");
    }

    // autoload
    if(token){ bootstrap(); }
  </script>
</body>
</html>
